https://www.bilibili.com/video/BV1mQ4y1C7Cn/

## 中间件

### 分类

Express中间件分类在Express中应用程序可以使用以下类型的中间件：

- 应用程序级别中间件
- 路由级别中间件
- 错误处理中间件
- 内置中间件
- 第三方中间件

### 用法

注意：如果当前的中间件功能没有结束请求-响应周期，则必须调用nxt0将控制权传递给下一个中间件功能。否则，该请求将被挂起。

```javascript
// 自定义中间件
// next 下一个中间件
// 路由也算一种中间件 只不过不需要next
app.use((req, res, next) => {
    console.log(req.method, req.url, Date.now());

    // 也可以不交执行权, 全部返回一样的内容
    // res.send("服务器正在维护中...")

    // 预处理参数
    req.foo = "bar";
    // 交出执行权
    next();
});
```

(1) 应用程序级别中间件

```javascript

// 不做任何限定
app.use((req, res, next) => {
    console.log(req.method, req.url, Date.now());
    next();
});

// 限定路由
app.use('/user/:id',(req, res, next) => {
    // ...
});

// 限定方法
app.get(
    //...
)

// 多个处理函数
app.use('/user/:id',(req, res, next) => {
    // ...
    next()
},(req, res, next) => {
    // ...
    next()
});


// 一个路径多个处理中间件
// 结合上面的


// 跳过中间件, 只能在method 或 route中
app.get('/user/:id',(req,res,next) => {
    if (req.params.id === "0" ) next('route')
    else next()
},(req,res,next) => {
   res.send("normal")
})

app.get('/user/:id',(req,res,next) => {
    res.send("admin")
})

```
